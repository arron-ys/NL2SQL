# DataTalk - 懂你的业务数据助手

把“找数据”从**提工单等人**，变成**一句话提问立刻拿结果**。  
**核心价值：** 不让业务靠猜、不让分析师当提数机器——**口径一致、权限可控、结果可追溯**。

---

## 行业痛点：数据获取的“最后一公里”拥堵

业务人员经常会遇到“临时、非固定报表”的问题（比如：上周某地区哪些渠道表现异常）。传统流程往往是：**提需求 → 排队 → 反复沟通口径 → 等结果**。

### 传统方式 vs DataTalk（对比表）

| 角色/场景 | 传统做法（没 DataTalk） | 用 DataTalk（有了之后） | 带来的变化（定性） |
|---|---|---|---|
| 老板/管理者临时追问 | 先问分析师/运营，等半天甚至第二天 | 直接一句话提问，当场拿到可解释结果 | 决策更快，会议更高效 |
| 运营/分析人员日常取数 | 重复做取数、拼表、截图汇报 | 把时间用在“为什么这样/怎么优化”，不是“怎么把数拿出来” | 人力从搬运转向分析 |
| 销售一线查业绩/客户 | 到处找人、找报表、找 Excel | 直接问“我负责区域本周/本月怎么样” | 一线更敏捷，行动更及时 |

---

## 3 个典型应用场景（你一看就知道能用在哪）

### 场景 1：老板 / 中高层管理者（会议里当场追问）
**以前：**临时问题没人敢拍板 → 会后再拉群等数据  
**现在：**当场问 DataTalk → 当场得到“结论 + 依据口径 + 可追溯来源”

**典型问法：**
- “公司本月整体销售额怎么样？相比上月变化原因是什么？”
- “华南大区本周 GMV 下降的主要城市是哪些？”

**你得到的：**
- 会议里直接做决策，不靠“感觉”和“拍脑袋”

---

### 场景 2：运营 / 分析人员（告别重复取数，把时间还给分析）
**以前：**埋点/Excel/各种 BI 里翻来翻去，临时需求堆成山  
**现在：**DataTalk 负责“把数拿出来”，你负责“解释与优化”

**典型问法：**
- “上周北京复购率 >20% 的渠道有哪些？按渠道类型排序”
- “最近 4 周转化率趋势如何？异常点在哪一周？”

**你得到的：**
- 少做搬运，多做洞察；沟通口径成本更低

---

### 场景 3：销售人员（一线随时查自己的数据，行动更快）
**以前：**找运营/找主管/等日报，错过最佳跟进时机  
**现在：**随时问 DataTalk → 立刻知道该跟谁、该补什么动作

**典型问法：**
- “我负责的华南区，本周新增客户数和 GMV 各是多少？”
- “本月 Top10 客户里，哪些客户增长最快？我该优先跟进谁？”

**你得到的：**
- 从“等数据”变成“拿数据就能行动”

## 3 个典型应用场景（你一看就知道能用在哪）

| 场景角色 | 以前（没 DataTalk） | 现在（用 DataTalk） | 典型问法（示例） | 你得到的价值 |
|---|---|---|---|---|
| 老板 / 中高层管理者（会议追问） | 临时问题没人敢拍板 → 会后拉群等数据 | 当场一句话提问 → 当场给出结论 + 可追溯依据 | “公司本月整体销售额怎么样？相比上月变化原因是什么？”<br>“华南大区本周 GMV 下降的主要城市是哪些？” | 会议里直接决策，不靠感觉拍脑袋 |
| 运营 / 分析人员（日常取数） | 在埋点/Excel/BI 里翻来翻去 → 临时需求堆成山 | DataTalk 负责把数拿出来 → 你专注解释与优化 | “上周北京复购率 >20% 的渠道有哪些？按渠道类型排序”<br>“最近 4 周转化率趋势如何？异常点在哪一周？” | 少做搬运，多做洞察；沟通口径成本更低 |
| 销售人员（一线查业绩） | 找运营/找主管/等日报 → 错过最佳跟进时机 | 随时问一句 → 立刻知道该跟谁、补什么动作 | “我负责的华南区，本周新增客户数和 GMV 各是多少？”<br>“本月 Top10 客户里，哪些客户增长最快？我该优先跟进谁？” | 从等数据变成拿数据就行动 |

---

## 一句话边界（先说清楚，避免被追问击穿）
DataTalk 的效果取决于企业的数据口径与权限配置：**口径越清晰、权限越规范，输出越稳定；遇到口径缺失会明确提示缺口，而不是瞎给答案。**

---

# 技术与实现（后半段：先占位，后续补齐）

## 技术难点（占位1）
- 【占位1：这里放“为什么不能直接让模型写 SQL”，以及 DataTalk 的解决思路】

## 落地程度（占位2）
- 【占位2：这里放“当前已做到什么程度/怎么跑起来/可验证证据位”】【占位2】

## 差异化（占位3）
- 【占位3：这里放“安全合规、口径治理、稳定性”等差异点】【占位3】

- **“意图-编译”分离**：LLM 只产出 **PLAN Skeleton**，后端用规则与语义层做**确定性编译** → 可控、可测、可回归。
- **强契约 PLAN**：全链路围绕统一数据结构流转 → 调试与阶段定位天然清晰（错在拆解 / Plan / 校验 / SQL / 执行 / 解释，一眼就能断层）。
- **语义层治理（YAML SSoT）**：指标 / 维度 / 枚举 / 默认时间 / 强制过滤统一落在配置 → 业务变更只改配置，不改代码。
- **默认值与兜底策略**：如指标自带 `default_time`（字段 + 时间窗口 + fallback），Plan 不完整也能自动补齐到“可执行形态”。
- **企业级权限模型**：角色 → 范围 → RLS 片段的显式配置与强制注入 → 越权不可生成、越权不可执行。
- **MVP 能力边界明确（可运营）**：明确列出 V1 不支持项（跨事实表、嵌套查询、自定义时间偏移等），并要求代码**熔断报错** → 避免“看似支持、实际乱跑”。

## 端到端架构（你一眼就能看懂的流水线）


---

## 语义层长什么样（真实配置片段）

### Metric（指标）

- `METRIC_GMV`：`SUM(line_gmv)`，默认时间窗口近 30 天，默认过滤 `LF_REVENUE_VALID_ORDER`
- `METRIC_AOV`：比率指标（`METRIC_GMV / METRIC_ORDER_CNT`），支持 `safe_division`

示例（片段示意）：

```yaml
metrics:
  - metric_id: METRIC_GMV
    expr: "SUM(line_gmv)"
    default_time:
      time_field_id: TF_ORDER_DATE
      window: TW_LAST_30_DAYS
      fallback: TW_THIS_YEAR
    default_filters:
      - LF_REVENUE_VALID_ORDER

  - metric_id: METRIC_AOV
    expr: "safe_division(${METRIC_GMV}, ${METRIC_ORDER_CNT})"
```


## Entity（实体）与 Semantic View（语义视图）

- `ENT_SALES_ORDER_ITEM` → `semantic_view: v_sales_order_item`
- `ENT_EMPLOYEE` → `semantic_view: v_employee_profile`

> **MVP 阶段的关键设计**：SQL `FROM` 只指向语义视图（宽表），不动态推导复杂 `JOIN`，把复杂性固定在数据建模层（更稳、更可控）。

---

## 产品级的“可解释性”（不是瞎跑）

这个项目最像“工程系统”的地方：它天然支持把每一步都讲清楚——

- **Plan 是可读的**：你能看到模型到底选了什么指标、什么维度、什么过滤、什么时间范围。
- **校验是可解释的**：ID 是否存在、是否允许维度、枚举值是否落在集合内、是否触发不支持特性熔断。
- **SQL 是可审计的**：RLS 注入了什么、默认过滤加了什么、时间窗口落成了什么日期范围。

---

## 接口形态（服务端对外）

作为后端服务，它可以提供：

- `POST /nl2sql/plan`：只产出 PLAN（用于 Debug / 可视化 / 回归）
- `POST /nl2sql/sql`：产出 SQL（用于审计）
- `POST /nl2sql/execute`：执行并返回结构化结果 + Answer（端到端）

- ## 🛠️ 技术架构与部署 (Technical Details)

> *以下内容为技术实现细节，供开发者参考。*

### [技术架构图占位]
*(此处将展示 Semantic Layer 的数据流转图)*

### [核心模块说明占位]
*(此处将介绍 QueryPlan 定义与 Compiler 实现)*

### [部署指南占位]
*(Docker Compose 启动命令)*


## 📸 演示 (Demo)

*(此处建议放置 GIF 或截图，展示从“输入自然语言”到“生成图表”的全过程)*

---

## 📞 联系作者 (Contact)

如果你对 **LLM 落地企业级数据分析**、**语义层架构设计** 感兴趣，欢迎通过以下方式交流：
*   **Email**: [Your Email]
*   **Blog/Resume**: [Your Link]


